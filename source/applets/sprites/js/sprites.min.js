var image_list=document.getElementById("image_list"),settings=document.getElementById("settings"),submit_btn=document.getElementById("submit_btn"),dropbox=document.getElementById("dropbox"),workplace=document.getElementById("workplace"),workplace_width=0,workplace_height=0,background_size=document.getElementById("background_size"),css_code=document.getElementById("css_code"),sprites_img=document.getElementById("sprites_img"),result_pop=document.getElementById("result_pop"),workplace_ctx=workplace.getContext("2d"),sprites=[];function handleFiles(e,i){for(var t=0;t<e.length;t++){var s=e[t];if(s.type.match(/image*/)){var r=new FileReader;r.onload=function(t){return function(e){console.log(t),FileReaderOnload(e,t,i)}}(s),r.readAsDataURL(s)}}}function FileReaderOnload(e,t,i){var s,r,n=document.createElement("div"),p=document.createElement("img"),o=document.createElement("li"),a=document.createElement("dl"),d=[];p.src=e.target.result,d.push({text:"文件名称：",value:t.name}),d.push({text:"文件大小：",value:p.width+"px X "+p.height+"px"}),d.push({text:"文件尺寸：",value:formateFileSize(e.total)}),d.push({text:"文件类型：",value:getFileType(t.type)}),d.push({text:"上次修改时间：",value:formatDate(t.lastModifiedDate,"yyyy-MM-dd hh:mm:ss")}),d.forEach(function(e){s=document.createElement("dt"),r=document.createElement("dd"),s.innerHTML=e.text,r.innerHTML=e.value,a.appendChild(s),a.appendChild(r)}),n.classList.add("img_container"),n.appendChild(p),o.appendChild(n),o.appendChild(n.cloneNode(!0)),i(o,e,t),sprites.push({img:p,file:t})}function getFileName(e){return(e=e.split(".")).pop(),e.join("."),e}function drawSprites(e,t){var i;if(workplace_height=workplace_width=0,"v_l"==e){for(i=0;i<sprites.length;i++)workplace_width<sprites[i].img.width&&(workplace_width=sprites[i].img.width);for(i=0;i<sprites.length;i++)(sprites[i].x=0)==i?(sprites[i].y=workplace_height,workplace_height+=sprites[i].img.height):(sprites[i].y=workplace_height+t,workplace_height+=sprites[i].img.height+t)}else if("v_r"==e){for(i=0;i<sprites.length;i++)workplace_width<sprites[i].img.width&&(workplace_width=sprites[i].img.width);for(i=0;i<sprites.length;i++)sprites[i].x=workplace_width-sprites[i].img.width,0==i?(sprites[i].y=workplace_height,workplace_height+=sprites[i].img.height):(sprites[i].y=workplace_height+t,workplace_height+=sprites[i].img.height+t)}else if("h_t"==e){for(i=0;i<sprites.length;i++)workplace_height<sprites[i].img.height&&(workplace_height=sprites[i].img.height);for(i=0;i<sprites.length;i++)(sprites[i].y=0)==i?(sprites[i].x=workplace_width,workplace_width+=sprites[i].img.width):(sprites[i].x=workplace_width+t,workplace_width+=sprites[i].img.width+t)}else if("h_b"==e){for(i=0;i<sprites.length;i++)workplace_height<sprites[i].img.height&&(workplace_height=sprites[i].img.height);for(i=0;i<sprites.length;i++)sprites[i].y=workplace_height-sprites[i].img.height,0==i?(sprites[i].x=workplace_width,workplace_width+=sprites[i].img.width):(sprites[i].x=workplace_width+t,workplace_width+=sprites[i].img.width+t)}for(workplace.width=workplace_width,workplace.height=workplace_height,i=0;i<sprites.length;i++)workplace_ctx.drawImage(sprites[i].img,sprites[i].x,sprites[i].y,sprites[i].img.width,sprites[i].img.height)}function generateCss(e,t){var i,s,r="",n=background_size.checked?2:1,p=[];if(console.log(background_size.checked,n),"v_l"==e)for(s=0;s<sprites.length;s++)i="."+getFileName(sprites[s].file.name),p.push(i),r+=i+"{background-position: 0 "+-sprites[s].y/n+"px; width: "+sprites[s].img.width/n+"px; height: "+sprites[s].img.height/n+"px;}\n";else if("v_r"==e)for(s=0;s<sprites.length;s++)i="."+getFileName(sprites[s].file.name),p.push(i),r+=i+"{background-position: 100% "+-sprites[s].y/n+"px; width: "+sprites[s].img.width/n+"px; height: "+sprites[s].img.height/n+"px;}\n";else if("h_t"==e)for(s=0;s<sprites.length;s++)i="."+getFileName(sprites[s].file.name),p.push(i),r+=i+"{background-position: "+-sprites[s].x/n+"px 0; width: "+sprites[s].img.width/n+"px; height: "+sprites[s].img.height/n+"px;}\n";else if("h_b"==e)for(s=0;s<sprites.length;s++)i="."+getFileName(sprites[s].file.name),p.push(i),r+=i+"{background-position: "+-sprites[s].x/n+"px 100%; width: "+sprites[s].img.width/n+"px; height: "+sprites[s].img.height/n+"px;}\n";return r}function formateFileSize(e){var t,i,s,r=1024;e-=(s=Math.floor(e/r/r/r))*r,e-=(i=Math.floor(e/r/r))*r,t=Math.ceil(e/r);var n=[];return 0<s&&n.push(s+"G"),0<i&&n.push(i+"M"),0<t&&n.push(t+"K"),n.join("")}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("dragenter",function(){dropbox.classList.add("dragFile")},!1),document.addEventListener("dragleave",function(){dropbox.classList.remove("dragFile")},!1),dropbox.addEventListener("dragenter",function(){dropbox.classList.add("dragenter")},!1),dropbox.addEventListener("dragleave",function(){dropbox.classList.remove("dragenter")},!1),dropbox.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),dropbox.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1),dropbox.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),console.log(e),settings.style.display="block",handleFiles(e.dataTransfer.files,function(e){image_list.appendChild(e)})},!1),submit_btn.addEventListener("click",function(){var e=document.getElementById("type").value,t=parseInt(document.getElementById("padding").value),i=document.getElementById("filename").value;console.log(sprites),drawSprites(e,t),css_code.value=generateCss(e,i);var s=workplace.toDataURL();sprites_img.querySelector("img").src=s,result_pop.style.display="block",settings.style.display="none",dropbox.style.display="none";var r=document.createEvent("HTMLEvents");r.initEvent("click",!1,!1),sprites_img.download=i,sprites_img.href=s,sprites_img.dispatchEvent(r)},!1)});var getFileType=function(){var t={"image/gif":"GIF","image/png":"PNG","image/jpeg":"JPG"};return function(e){return t[e]}}();function formatDate(e,t){var i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var s in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[s]:("00"+i[s]).substr((""+i[s]).length)));return t}
//# sourceMappingURL=sprites.min.js.map
